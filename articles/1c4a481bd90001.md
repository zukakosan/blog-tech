---
title: "Azureにおけるクロスプレミスの名前解決をIaaSでDNSフォワーダを作って実現する"
emoji: "💭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# モチベ
- Azureにおけるクロスプレミスの名前解決はAzure CAF上は`Azure DNS Private Resolver`を使えというのが推奨になっている
- 同サービスは比較的最近GAしたものであり、IaaSでフォワーダを立てたい場面が結構ある
- しかし、(オンプレミスの技術の延長にあるためか)文献が少ない
- 改めて一通りの検証をクラウド上でやっておきたい

## そもそも何故クロスプレミスの名前解決を検討する必要があるか
- Azure DNSをホストしているエンドポイント`168.63.129.10`はAzure上のリソースからしか到達できない特殊なものとなっている
    - ここでのAzure DNSはいわゆるパブリックなコンテンツサーバであるところのAzure DNSパブリックゾーンとは異なり、DNSリゾルバを指す(多分)
- このエンドポイントは特に、Private DNSゾーンを利用する際には切っても切れない関係にあり、Private DNSゾーンへの問い合わせにはこのアドレスを経由する必要がある
    - つまり、Private Endpointを利用しようと思うと確実にこの話が出てくる
    - しかし、オンプレミスから直接このアドレスに到達できないため、Azure上にそのDNS要求を仲介してくれる存在が必要

こんな感じで、クロスプレミスの名前解決はネットワーク構成と共に検討される。今回はAzure側の仲介役として、従来から用いられるIaaSでのDNSフォワーダを利用する場合を検討する。

# アーキテクチャ
- [例のbicep](https://zenn.dev/microsoft/articles/8d1558a8a2127c)から基本は展開
- オンプレ側にはActive Directory用のWindows Serverを追加
- クラウド側にはDNSフォワーダ用のWindows Serverを追加
- クラウド側にストレージアカウントおよび対応するPrivate Endpoint/Private DNS Zoneを作成
![](/images/20230502-dnsfwd/arch.png)

