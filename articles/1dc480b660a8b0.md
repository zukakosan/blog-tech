---
title: "ITéƒ¨é–€ãŒç®¡ç†ã™ã‚‹Azure Virtual Networkã« å„éƒ¨ç½²ã®VMã‚’æ‰€å±ã•ã›ã¦è·å‹™åˆ†æŒã‚’è¡Œã†æ–¹æ³•"
emoji: "ğŸ‘¨â€ğŸ’¼"
type: "tech"
topics:
  - "azure"
  - "rbac"
  - "vm"
  - "vnet"
published: true
published_at: "2023-04-05 09:30"
publication_name: "microsoft"
---

# ãƒ¢ãƒãƒ™
ä¸‹è¨˜ã®ã‚ˆã†ãªã‚·ãƒŠãƒªã‚ªã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã—ãŸã„
- ITéƒ¨é–€ãŒAzureç’°å¢ƒã‚’é‹å–¶ã—ã¦ãŠã‚Šã€ãã®ä»–å„éƒ¨ç½²ã¯ãã“ã‹ã‚‰æ‰•ã„å‡ºã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã‚’åˆ©ç”¨ã™ã‚‹
- å„éƒ¨ç½²ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã®å¤‰æ›´ã¯ã§ããªã„ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- å„éƒ¨ç½²ã«å°‚ç”¨ã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç”¨æ„ã™ã‚‹ã¨ã“ã‚ã¾ã§ã¯ITéƒ¨é–€å´ã§å®Ÿæ–½
- å„éƒ¨ç½²ã¯ãã‚Œãã‚Œè‡ªç”±ã«VMã‚’ç«‹ã¦ãŸã‚Šã—ãªãŒã‚‰Azureç’°å¢ƒã‚’åˆ©ç”¨
	- VMã¯ITéƒ¨é–€ãŒç®¡ç†ã™ã‚‹VNETã®ã‚µãƒ–ãƒãƒƒãƒˆã«æ‰€å±
- ITéƒ¨é–€ã¯æœˆæ¬¡ã§å„éƒ¨ç½²ã«ãã‚Œãã‚Œã®åˆ©ç”¨é¡ã‚’è«‹æ±‚

# æƒ³å®šAzureç’°å¢ƒ
- Networkãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼šITéƒ¨é–€ã§ç®¡ç†
- VMãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼šå„éƒ¨ç½²ãŒåˆ©ç”¨ã€‚ä»Šå›ã¯IaaSç’°å¢ƒã®ã¿ã®åˆ©ç”¨ã‚’æƒ³å®šã€‚

# æ§‹æˆæ–¹æ³•
- çµå±€ã®ã¨ã“ã‚RBACãƒ­ãƒ¼ãƒ«ã‚’å„éƒ¨ç½²ã®ãƒ¦ãƒ¼ã‚¶orã‚°ãƒ«ãƒ¼ãƒ—ã«ã©ã®ã‚ˆã†ã«å‰²ã‚Šå½“ã¦ã‚‹ã‹ã€ã¨ã„ã†ã ã‘ã®è©±

## å„éƒ¨ç½²ã®ãƒ¦ãƒ¼ã‚¶ã«å‰²ã‚Šå½“ã¦ã‚‹ãƒ­ãƒ¼ãƒ«
- Networkãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§`é–²è¦§è€…`ã‚’å‰²ã‚Šå½“ã¦ã‚‹
	- VMã®æ‰€å±ã™ã‚‹VNETãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚
- VMãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§`ä»®æƒ³ãƒã‚·ãƒ³å…±åŒä½œæˆè€…`ã‚’å‰²ã‚Šå½“ã¦ã‚‹
	- ä»®æƒ³ãƒã‚·ãƒ³ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®æ¨©é™
	- https://learn.microsoft.com/ja-jp/azure/role-based-access-control/built-in-roles#virtual-machine-contributor

- ãŸã ã€ä»®æƒ³ãƒã‚·ãƒ³å…±åŒä½œæˆè€…ãƒ­ãƒ¼ãƒ«ã ã‘ã§ã¯ã€VMã®NICã‚’å¯¾è±¡ã®ã‚µãƒ–ãƒãƒƒãƒˆã«æ‰€å±ã•ã›ã‚‹æ¨©é™ãŒè¶³ã‚Šãªã„
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/9a5cb3fe2924-20230405.png)

- â€œMicrosoft.Network/virtualNetworks/subnets/join/actionâ€æ¨©é™ãŒå¿…è¦
	- ã“ã®æ¨©é™ã‚’å†…åŒ…ã—ãŸã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€Networkãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§å‰²ã‚Šå½“ã¦ã‚‹
## ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
- Networkãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§`ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡(IAM)`ã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ
![](https://storage.googleapis.com/zenn-user-upload/83aa7d552252-20230405.png)

- æœ€åˆã‹ã‚‰å§‹ã‚ã‚‹ã€ã‚’é¸æŠ
- ä¸Šè¨˜ã®æ¨©é™ã‚’æ¤œç´¢ã—ã€ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’è¿½åŠ 
![](https://storage.googleapis.com/zenn-user-upload/9d3feb73d9ea-20230405.png)
- ã‚ã¨ã¯ç”»é¢ã«å¾“ã£ã¦ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ã«ä»˜ä¸ã™ã‚‹
- ãƒ­ãƒ¼ãƒ«ä»˜ä¸å®Œäº†å¾Œã€ã‚¨ãƒ©ãƒ¼ãŒæ¶ˆãˆã‚‹
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/335476c9e884-20230405.png)

- ã¾ãŸã€ä»®æƒ³ãƒã‚·ãƒ³å…±åŒä½œæˆè€…ãƒ­ãƒ¼ãƒ«ã«ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPä½œæˆæ¨©é™ã‚‚ãªã„ãŸã‚ã€ä¸Šè¨˜ã®ç”»é¢ã®ã‚ˆã†ã«å‹§ã‚ã¦ã„ãã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
	- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ITéƒ¨é–€ãŒç®¡ç†ã—ã¦ã„ã‚‹ãªã‚‰ä½œæˆã§ããªãã¦æ­£è§£ã§ã¯ã‚ã‚‹
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/911e6334618b-20230405.png)
```
{"code":"InvalidTemplateDeployment","message":"The template deployment failed with error: 'Authorization failed for template resource 'demovm-ip' of type 'Microsoft.Network/publicIpAddresses'. The client 'demo@msext.net' with object id '0884995c-d3bb-4b43-a362-ba0445929d7c' does not have permission to perform action 'Microsoft.Network/publicIpAddresses/write' at scope '/subscriptions/42edd95d-ae8d-41c1-ac55-40bf336687b4/resourceGroups/20230404-rg-vm/providers/Microsoft.Network/publicIpAddresses/demovm-ip'.'."}
```
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚’`ãªã—`ã«ã—ã¦ä½œæˆã™ã‚‹ã¨ã€é€šã‚‹
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/65762cf54daf-20230405.png)

- ã¨æ€ã£ãŸã‚‰ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
	- ITéƒ¨é–€å´ã§ç”¨æ„ã—ã¦ã„ã‚‹NSGã«NICã‚’Joinã™ã‚‹æ¨©é™ãŒãªã„(å…ˆã«Validationã—ã¦ã»ã—ã„ã€ã€ã€)
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/0d59d3242a22-20230405.png)

```
{"code":"DeploymentFailed","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"LinkedAuthorizationFailed","message":"ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ID '0884995c-d3bb-4b43-a362-ba0445929d7c' ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ 'demo@msext.net' ã«ã¯ã€ã‚¹ã‚³ãƒ¼ãƒ— '/subscriptions/42edd95d-ae8d-41c1-ac55-40bf336687b4/resourcegroups/20230404-rg-vm/providers/Microsoft.Network/networkInterfaces/demovm139' ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ 'Microsoft.Network/networkInterfaces/write' ã‚’å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒã‚ã‚Šã¾ã™ãŒã€ãƒªãƒ³ã‚¯ã•ã‚ŒãŸã‚¹ã‚³ãƒ¼ãƒ— '/subscriptions/42edd95d-ae8d-41c1-ac55-40bf336687b4/resourceGroups/20230404-rg-networking/providers/Microsoft.Network/networkSecurityGroups/rg-networking-nsg' ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ 'Microsoft.Network/networkSecurityGroups/join/action' ã‚’å®Ÿè¡Œã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒãªã„ã‹ã€ãƒªãƒ³ã‚¯ã•ã‚ŒãŸã‚¹ã‚³ãƒ¼ãƒ—ãŒç„¡åŠ¹ã§ã™ã€‚"}]}
```

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€šã‚Šã€ä¸è¶³ã—ã¦ã„ã‚‹'Microsoft.Network/networkSecurityGroups/join/action' ã“ã‚Œã‚’è¿½åŠ ã™ã‚‹
- ã‚‚ã—ãã¯NICãƒ¬ãƒ™ãƒ«ã§ã®NSGã®ä»˜ä¸ã‚’ã—ãªã„æ–¹é‡ã«ã™ã‚‹
	- VMãŒæ‰€å±ã™ã‚‹å…ˆã®ã‚µãƒ–ãƒãƒƒãƒˆã«ã¯NSGãŒã‚ã‚‹ã‹ã‚‰ã„ã„ã‚ˆã­ã€ã¨ã„ã†è€ƒãˆæ–¹
- ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã¨NICã‚’ã©ã¡ã‚‰ã‚‚ç„¡ã—ã«ã™ã‚‹ã¨ã€ä½œæˆã§ãã‚‹
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/8184a69e7d2c-20230405.png)
â€»éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶å´ã§ã®ä½œæˆç”»é¢
![](https://storage.googleapis.com/zenn-user-upload/596afb1dcad5-20230405.png)

# ãŠã‚ã‚Š
ã¾ã¨ã‚ã‚‹ã¨ã€éƒ¨ç½²ãƒ¦ãƒ¼ã‚¶ã«ä¸‹è¨˜ãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã‚‹
- VMä½œæˆç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§ã®`ä»®æƒ³ãƒã‚·ãƒ³å…±åŒä½œæˆè€…`
- Networkãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã§ã®â€œMicrosoft.Network/virtualNetworks/subnets/join/actionâ€æ¨©é™ã‚’æŒã¤ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«
