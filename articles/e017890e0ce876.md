---
title: "Microsoft Ignite 2023ã§ç™ºè¡¨ã•ã‚ŒãŸVMã®Hibernateã‚’AVDã®å€‹äººå‹ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã«åˆ©ç”¨ã™ã‚‹"
emoji: "ğŸ”‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["microsoft","ignite","AVD","VM"]
published: false
publication_name: "microsoft"
---
# ã“ã‚Œã¯ä½•...?
- 2023å¹´11/15-17ã«ã‹ã‘ã¦ITé–‹ç™ºè€…ãŠã‚ˆã³ãƒ“ã‚¸ãƒã‚¹æ„æ€æ±ºå®šè€…å‘ã‘ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚ã‚‹ Microsoft Ignite ãŒé–‹å‚¬ã•ã‚Œã¦ã„ã¾ã™ã€‚
- Microsoft Ignite 2023 Book of News[*1] ã®ä¸­ã§ã‚‚è§¦ã‚Œã‚‰ã‚Œã¦ã„ã‚‹ Azure Virtual Desktop Autoscale for Personal Desktops ã«ãŠã‘ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã® `Hibernate` ã®æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚
- ã“ã¡ã‚‰ã®æ©Ÿèƒ½ã¯ç¾åœ¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã§ã™ã€‚
- å˜ã«å€‹äººå‹ AVD ã®ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«ã«ã¤ã„ã¦ã¯[åˆ¥ã®è¨˜äº‹](https://zenn.dev/microsoft/articles/8b76d3ab77d497)ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€ãã¡ã‚‰ã¨ä½µã›ã¦ã”å‚ç…§ãã ã•ã„ã€‚

# ä»®æƒ³ãƒã‚·ãƒ³ã® Hibernate (ä¼‘æ­¢çŠ¶æ…‹)ã¨ã¯
ç´°ã‹ã„ç‚¹ã«ã¤ã„ã¦ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ[*2]ã‚„ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°[*3]ã‚’ã”å‚ç…§ã„ãŸã ããŸã„ã¨ã“ã‚ã§ã™ãŒã€è¶…ã–ã£ãã‚Šè¨€ã†ã¨ã€ŒVM ã®ãƒ¡ãƒ¢ãƒªå†…çŠ¶æ…‹ãŒç¶­æŒã•ã‚ŒãŸã¾ã¾ã€ãƒã‚·ãƒ³ã®å‰²ã‚Šå½“ã¦ã‚’è§£é™¤ã™ã‚‹ã€ã“ã¨ã§ã€Œãƒã‚·ãƒ³ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›ã€ã—ã¤ã¤ã€ã€ŒVM ã®å†èµ·å‹•å¾Œã«ã‚¢ãƒ—ãƒªã¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’æœ€å¾Œã®çŠ¶æ…‹ã‹ã‚‰å†é–‹ã€ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã«ãŠã„ã¦ã€ã“ã® `Hibernate` ã®åˆ©ç”¨ã‚·ãƒŠãƒªã‚ªã®1ã¤ã¨ã—ã¦ã€AVD ãŒæŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
> Starting today, customers can also use hibernation (in preview) with Personal Desktop Autoscale and Start VM on Connect. Customers can configure their personal scaling plan to either hibernate or deallocate host machines. By choosing to hibernate machines, customers will be able to resume from right where they left off when the session starts again. 

# å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚‹
æ—¢å­˜ã® AVD ç’°å¢ƒã§è©¦ã—ã¦ã¿ã‚ˆã†ã€ã¨ãªã£ãŸã®ã§ã™ãŒã€‚Hibernate è‡ªä½“ãŒã¾ã åˆ¶é™ãŒçµæ§‹ã‚ã‚‹ã®ã§ãã“ã¯æ³¨æ„ã—ã¾ã™ã€‚
:::message
## VM ã‚µã‚¤ã‚ºã®åˆ¶é™
VM sizes with up to 32-GB RAM from the following VM series support hibernation.
- Dasv5-series
- Dadsv5-series
- Dsv5-series
- Ddsv5-series

## OS ã®åˆ¶é™(Windows æŠœç²‹)
The following Windows operating systems support hibernation:

- Windows Server 2022
- Windows Server 2019
- Windows 11 Pro
- Windows 11 Enterprise
- Windows 11 Enterprise multi-session
- Windows 10 Pro
- Windows 10 Enterprise
- Windows 10 Enterprise multi-session

Windows limitations
- The page file can't be on the temp disk.
- Applications such as Device Guard and Credential Guard that require virtualization-based security (VBS) work with hibernation when you enable Trusted Launch on the VM and Nested Virtualization in the guest OS.
- Hibernation is only supported with Nested Virtualization when Trusted Launch is enabled on the VM

## ä¸€èˆ¬çš„ãªåˆ¶é™
- You can't enable hibernation on existing VMs.
- You can't resize a VM if it has hibernation enabled.
- When a VM is hibernated, you can't attach, detach, or modify any disks or NICs associated with the VM. The VM must instead be moved to a Stop-Deallocated state.
- When a VM is hibernated, there's no capacity guarantee to ensure that there's sufficient capacity to start the VM later. In the rare case that you encounter capacity issues, you can try starting the VM at a later time. Capacity reservations don't guarantee capacity for hibernated VMs.
- You can only hibernate a VM using the Azure portal, CLI, PowerShell, SDKs and API. Hibernating the VM using guest OS operations don't result in the VM moving to a hibernated state and the VM continues to be billed.
- You can't disable hibernation on a VM once enabled.
:::

ã¾ãšäº‹å‰æº–å‚™ã¨ã—ã¦ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ Hibernate ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’ç™»éŒ²ã—ã¾ã™ã€‚
![](/images/20231117-avd-hibernate/01.png)

æ—¢å­˜ã® VM ã«å¯¾ã—ã¦ã¯ Hibernate ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã€ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã« Hibernate ã‚’æœ‰åŠ¹åŒ–ã—ãŸæ–°è¦ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆVMã‚’è¿½åŠ ã—ã¾ã™ã€‚ç™»éŒ²ã‚­ãƒ¼ã®ä½œæˆã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹å ´åˆã¯ç”»é¢ã«å¾“ã„ã¾ã™ã€‚Hibernate åˆ©ç”¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã®ã¿ã«ã—ãŸã„å ´åˆã«ã¯ã€ä»¥å‰ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã‚’ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã€‚
![](/images/20231117-avd-hibernate/02.png)

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸Šã¯ Windows 11 å¯¾å¿œã—ã¦ã„ã‚‹ã¨ã„ã†è¨˜è¼‰ãŒã‚ã‚‹ã®ã§ã™ãŒã€Azure Portal å´ã§æ€’ã‚‰ã‚Œã¦ã—ã¾ã£ãŸã®ã§ã€ä¸€æ—¦ Windows 10 ã§ä½œæˆã—ã¾ã™ã€‚
![](/images/20231117-avd-hibernate/03.png)
![](/images/20231117-avd-hibernate/04.png)

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã€`RUNNING`ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚æ¬¡ã«ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ—ãƒ©ãƒ³ã«ãŠã„ã¦ã€åˆ‡æ–­æ™‚ã®æŒ™å‹•ã‚’ã€Œä¼‘æ­¢çŠ¶æ…‹ã€ã«è¨­å®šã—ã¾ã™ã€‚ãƒ”ãƒ¼ã‚¯æ™‚é–“(æ‰‹å…ƒã®è¨­å®šã«ãŠã„ã¦ã¯9æ™‚-18æ™‚ã€æ¤œè¨¼ã¯10æ™‚ã”ã‚ã«è¡Œã£ã¦ã„ã‚‹)ã«ãŠã„ã¦ã€åˆ‡æ–­å¾Œå³åº§ã«ä¼‘æ­¢çŠ¶æ…‹ã«å…¥ã‚‹è¨­å®šã¨ã—ã¦ã¿ã¾ã™ã€‚
![](/images/20231117-avd-hibernate/05.png)

AVD ã® Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(https://client.wvd.microsoft.com/arm/webclient/index.html)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€è©²å½“ã® Desktop Application ã‚’é¸æŠã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã«ã¦ã€ãƒ¦ãƒ¼ã‚¶ãŒå‰²ã‚Šå½“ãŸã£ãŸã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
![](/images/20231117-avd-hibernate/06.png)

# Reference
- [*1] Microsoft Ignite 2023 Book of News (æ—¥æœ¬èª)

https://news.microsoft.com/ignite-2023-book-of-news/ja/
- [*2] ä»®æƒ³ãƒã‚·ãƒ³ã®ä¼‘æ­¢çŠ¶æ…‹

https://learn.microsoft.com/ja-jp/azure/virtual-machines/hibernate-resume?tabs=osLimitsWindows%2CenablehiberPortal%2CcheckhiberPortal%2CenableWithPortal%2CcliLHE%2CUbuntu18HST%2CPortalDoHiber%2CPortalStatCheck%2CPortalStartHiber%2CPortalImageGallery

â€• [*3] Reduce Compute Costs by Pausing VMs (now in public preview)

https://techcommunity.microsoft.com/t5/azure-compute-blog/reduce-compute-costs-by-pausing-vms-now-in-public-preview/ba-p/3981127