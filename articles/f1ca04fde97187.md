---
title: "Azure VM ã«ãŠã‘ã‚‹ OS å´ã§ã®é–‹æ”¾ãƒãƒ¼ãƒˆã¨ãã®ç¢ºèª (Nmap)"
emoji: "ğŸ›¡ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azure","IaaS","VM","microsoft"]
published: true
publication_name: "microsoft"
---

# ã“ã‚Œã¯ä½•...?
æ™®æ®µã€NSG ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶å¾¡ã‚’ã—ã¦ã„ã‚‹ã¨ã‚ã¾ã‚Šæ„è­˜ã—ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Windows/Linux ã¨ã‚‚ã« OS å´ã«ã‚‚ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’æŒã£ã¦ãŠã‚Šã€NSG ã§è¨±å¯ã—ã¦ã„ã‚‹ã®ã«åˆ°é”ã§ããªã„ã¿ãŸã„ãªã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®è¾ºã®æŒ™å‹•ã‚’ Nmap ã‚’ä½¿ã£ã¦ç¢ºèªã—ã¾ã™ã€‚

# Nmap ã¨ã¯
Wiki(*1)ã«ã‚ˆã‚Œã°ä»¥ä¸‹ã‚‰ã—ã„ã§ã™ã€‚

> nmapã¯Gordon Lyonã«ã‚ˆã£ã¦æ›¸ã‹ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒŠã§ã‚ã‚‹ã€‚ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã ã‘ã§ãªãã€OSã‚„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ¤œå‡ºæ©Ÿèƒ½ã€ã‚µãƒ¼ãƒ“ã‚¹ãŠã‚ˆã³ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ¤œå‡ºæ©Ÿèƒ½ãªã©ã€å¤šãã®æ©Ÿèƒ½ã‚’å…¼ã­å‚™ãˆã¦ã„ã‚‹

ä»Šå›ã¯ Ubuntu ã¨ Windows Server ã‚’ç«‹ã¦ã¦ã€Nmap ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«(*2)ã™ã‚Œã° Windows ã§ã‚‚åˆ©ç”¨ã§ãã¾ã™ã€‚Ubuntu ã®å ´åˆã¯ `sudo apt  install nmap` ã§ã™ãã«å…¥ã‚Šã¾ã™ã€‚ãã®ã†ãˆã§å„ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ localhost ã«å¯¾ã—ã¦ ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã‚’ã‹ã‘ã¾ã™ã€‚VM ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ Marketplace ã®çœŸã£æ–°ãªçŠ¶æ…‹ã§ã™ã€‚çµæœã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

Linux (ubuntu 20.04)
```
vm-ubuntu:~$ nmap localhost
Starting Nmap 7.80 ( https://nmap.org ) at 2023-11-08 08:20 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00018s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.07 seconds
```
æ—¢å®šã§ 22/tcp ãŒé–‹ã„ã¦ã„ã¾ã™ã­ã€‚

Windows (Windows Server 2022 Datacenter Azure Edition)
```
C:\Users\xxxx>nmap localhost
Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 08:32 Coordinated Universal Time
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00019s latency).
Other addresses for localhost (not scanned): ::1
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE
135/tcp  open  msrpc
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server

Nmap done: 1 IP address (1 host up) scanned in 0.26 seconds
```
æ—¢å®šã§ã€135/tcpã€445/tcpã€3389/tcpã€ãŒé–‹æ”¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

::: message 
## Column: Apache ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®æŒ™å‹• 
Ubuntu ã«ãŠã„ã¦ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ 22/tcp ã—ã‹é–‹ã„ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆãªã„ã‘ã© Apache ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦æ¤œè¨¼ã™ã‚‹éš›ã«ã‚ã–ã‚ã– OS å´ã§é–‹æ”¾ã—ãŸè¨˜æ†¶ãŒãªã„ã¨æ€ã£ãŸã®ã§ã€Apache ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰å¾Œã§ã®ãƒãƒ¼ãƒˆé–‹æ”¾çŠ¶æ³ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚ç’°å¢ƒã¯ Ubunt 20.04 ã§ã™ã€‚

```
AzureAdmin@vm-ubuntu:~$ nmap localhost
Starting Nmap 7.80 ( https://nmap.org ) at 2023-11-08 08:20 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00018s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
 
Nmap done: 1 IP address (1 host up) scanned in 0.07 seconds
AzureAdmin@vm-ubuntu:~$ sudo apt install apache2
Reading package lists... Done
Building dependency tree
Reading state information... Done
<ç•¥>

AzureAdmin@vm-ubuntu:~$ nmap localhost
Starting Nmap 7.80 (
https://nmap.org
) at 2023-11-08 08:21 UTC
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00018s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
 
Nmap done: 1 IP address (1 host up) scanned in 0.07 seconds
```
Apach ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å¾Œã« `80/tcp open  http` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€NSG å´ã§ Inbound 80 ã‚’é–‹æ”¾ã™ã‚Œã°ã„ã„ã‚ã‘ã§ã™ã­ã€‚
:::

# NSG è¶Šã—ã®é€šä¿¡ã«ã¤ã„ã¦
Public IP(Standard SKU) è¶Šã—ã« ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã‚’ã‹ã‘ã‚‹ã¨ã©ã†è¦‹ãˆã‚‹ã®ã‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚å…ˆã»ã©ã¨åŒã˜ Apache ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ Ubuntu VM ã«å¯¾ã—ã¦ å¤–éƒ¨ã‹ã‚‰ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã¿ã¾ã™ã€‚VM ã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹ NSG ã«ã¯ã€ãƒãƒ¼ãƒˆ 80 ãŒé–‹æ”¾ã•ã‚Œã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚

```
PS C:\Users\xxxx> nmap 172.190.xxx.xxx
Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 20:12 æ±äº¬ (æ¨™æº–æ™‚)
Nmap scan report for 172.190.xxx.xxx
Host is up (0.18s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE
80/tcp open  http
```

80/tcp ãŒé–‹æ”¾ã•ã‚Œã¦ã„ã‚‹ã¨èªè­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚OS å†…éƒ¨ã§ã¯é–‹æ”¾ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¦ã„ãŸ 22/tcp ã¯é–‹æ”¾ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

## NSG ã‚’å¤–ã—ã¦ã¿ã‚‹
Public IP ã® Standard SKU ã®å ´åˆã€æ˜ç¤ºçš„ã« NSG ã§è¨±å¯ã—ãªã„ã¨é€šä¿¡ãŒã§ããªã„ä»•æ§˜(*3)ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€NSG ã‚’å¤–ã—ãŸçŠ¶æ…‹ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã¿ã¾ã™ã€‚

```
PS C:\Users\shizh> nmap 172.190.xxx.xxx
Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 20:23 æ±äº¬ (æ¨™æº–æ™‚)
Nmap scan report for 172.190.xxx.xxx
Host is up (0.18s latency).
All 1000 scanned ports on 172.190.xxx.xxx are in ignored states.
Not shown: 1000 filtered tcp ports (no-response)

Nmap done: 1 IP address (1 host up) scanned in 181.94 seconds
```
`no-response`ã¨è¨€ã‚ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã¨ã„ã†ã“ã¨ã§ NSG ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒ£ãƒ³ã«ã‚‚å¼•ã£ã‹ã‹ã‚‰ãªã„ã‚ã‘ã§ã™ã­ã€‚

::: message
## Column: Basic Public IP ã«ãŠã‘ã‚‹ ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³
ã€ŒPublic IP ãŒ Basic SKUã€ã‹ã¤ã€ŒNSG ãŒä»˜ä¸ã•ã‚Œã¦ã„ãªã„ã€å ´åˆã‚‚æ¯”è¼ƒã®ãŸã‚ã€ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚Basic SKU ã¯ãƒªã‚¿ã‚¤ã‚¢ã‚‚è¦‹ãˆã¦ã„ã‚‹ã®ã§ã€Colum ã¨ã—ã¾ã—ãŸã€‚å…ˆã»ã©ã® Ubuntu VM ã® Public IP ã‚’ Basic SKU ã«ä»˜ã‘æ›¿ãˆã¦ã€åŒã˜ã nmap ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒªã‚½ãƒ¼ã‚¹ã‚’ä»˜ã‘æ›¿ãˆãŸã®ã§ IP ã‚¢ãƒ‰ãƒ¬ã‚¹è‡ªä½“ã‚‚å¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚

```
PS C:\Users\shizh> nmap 52.186.xxx.xxx
Starting Nmap 7.94 ( https://nmap.org ) at 2023-11-08 20:40 æ±äº¬ (æ¨™æº–æ™‚)
Nmap scan report for 52.186.xxx.xxx
Host is up (0.18s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE    SERVICE
22/tcp open     ssh
25/tcp filtered smtp
80/tcp open     http
```
ä½•äº‹ã‚‚ãªãã€ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚25/tcp ãŒå¢—ãˆã¦ã„ãŸã®ã¯è¬ã§ã™ãŒã€æ·±è¿½ã„ã¯ã‚„ã‚ã¦ãŠãã¾ã™ã€‚

::: 

# ã¾ã¨ã‚
- Azure VM ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¿è­·ã«ã¯ NSG ãŒä¸­æ­¢ã•ã‚ŒãŒã¡ã ãŒã€OS å†…ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚‚åŠ¹ã„ã¦ã„ã‚‹
- ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã‚’å†…éƒ¨çš„ãƒ»å¤–éƒ¨çš„ã«ã‹ã‘ã¦ã¿ã‚‹ã¨ä¸€ç›®ç­ç„¶
- Basic SKU ã®å ´åˆã¯ NSG ãŒã‹ã‹ã£ã¦ã„ãªã„å ´åˆã« OS å†…ã®ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®è¨­å®šãŒãã®ã¾ã¾å¢ƒç•Œã¨ãªã‚‹ãŸã‚æ³¨æ„ãŒå¿…è¦

# Reference
- (*1) nmapã®Wikipedia

https://ja.wikipedia.org/wiki/Nmap

- (*2) Windows ã§ Nmap ã‚’ä½¿ã£ã¦ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³ã«ãƒˆãƒ©ã‚¤

https://qiita.com/san_bay3/items/705e630ec6b02fdc3bc2

- (*3) Public IP ã® SKU æ¯”è¼ƒ

https://learn.microsoft.com/ja-jp/azure/virtual-network/ip-services/public-ip-addresses#sku