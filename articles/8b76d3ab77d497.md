---
title: "Azure Virtual Desktopの個人型ホストプールにおける電源管理をスケーリングプランにより実現する"
emoji: "💬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
# モチベ
- 先日、AVDにおける個人型ホストプールにおけるスケーリングプランがパブリックプレビューとなったので試したい

https://learn.microsoft.com/ja-jp/azure/virtual-desktop/whats-new#autoscale-for-personal-host-pools-is-currently-in-preview

::: message
- 個人型のスケーリングプランはプール型のスケーリングプランとは全くの別物
- 個人型は以下のように動く(具体的には検証の中で触れる)
    - Start VM on ConnectでVMを起動、もしくは接続要求にかかわらずホストプールのVMを一斉にに起動
    - 「ｘ分切断状態が続いた」 or 「ｘ分ログオフ状態が続いた」をトリガーにしてVMのシャットダウンが可能
- プール型の場合は以下のように動く
    - 全体として許容するセッション数に対して、閾値を割合で定義しておく
    - その閾値を超えた場合にはスケールアウト・インする
:::

# 環境
Azure AD JoinのAVD環境を個人型ホストプールで作るだけ。
このあたりを参考に...

https://learn.microsoft.com/ja-jp/azure/virtual-desktop/azure-ad-joined-session-hosts

:::message alert
2点ほど見落としがちな注意点
- AVDの利用ユーザに[仮想マシン管理者ログイン]もしくは[仮想マシンユーザログイン]の権限を付与する必要がある。
- Azure AD Joinの場合、実際にAVDのセッションホストに接続するローカルPCがAVDのAzure ADテナントに何らかの形で参加もしくは登録していない場合、「カスタムRDPプロパティ」に`targetisaadjoined:i:1`を追加することをお忘れなく。
:::
