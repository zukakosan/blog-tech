---
title: "éæ¨å¥¨ãªãŒã‚‰ã‚‚Azure ExpressRoute CircuitæŠ˜ã‚Šè¿”ã—ã®VNETé–“æ¥ç¶šãŒã©ã“ã¾ã§ã§ãã‚‹ã®ã‹è©¦ã™"
emoji: "ğŸš…"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Azure","ExpressRoute","VNET","Peering"]
published: true
publication_name: "microsoft"
---
# ãƒ¢ãƒãƒ™
- Hub-Spokeæ§‹æˆã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ãŠã„ã¦ã€Spokeé–“é€šä¿¡ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ‰‹æ®µã®ä¸€ã¤ã¨ã—ã¦ã€ExpressRouteã§æŠ˜ã‚Šè¿”ã™ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒMicrosoftã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸Šã«ã‚ã’ã‚‰ã‚Œã¦ã„ã‚‹

https://learn.microsoft.com/ja-jp/azure/architecture/networking/spoke-to-spoke-networking
- æ‰‹æ®µã®ä¸€ã¤ã¨ã—ã¦æŒ™ã’ã¦ã„ã‚‹ä¸€æ–¹ã§ã€"éæ¨å¥¨"ã§ã‚ã‚‹ã“ã¨ãŒæ‚‰ãå¼·èª¿ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒâ€¦(ç¬‘)
> ExpressRoute. In certain configurations, an ExpressRoute gateway can advertise routes that attract spoke-to-spoke communication, sending traffic to the Microsoft edge router, where it's routed to the destination spoke. Microsoft **strongly discourages** this scenario because **it introduces latency by sending traffic to the Microsoft backbone edge and back**. On top of that, Microsoft does not recommend this approach, **due to the single point of failure and the large blast radius**. This scenario also presents multiple problems caused by putting extra pressure on the ExpressRoute infrastructure (the gateway and physical routers). **This additional pressure can cause packet drops**.

- ã“ã“ã¾ã§æ›¸ã‹ã‚Œã¦ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¡ç”¨ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚‹ã®ã‹ã¨ã„ã†ç–‘å•ã¯ã•ã¦ãŠãã€ExpressRouteã®æ€§è³ªã®æ¤œè¨¼ã®ä¸€ã¤ã¨ã—ã¦ã“ã“ã§è©¦ã—ã¦ãŠã

# ç”¨æ„ã™ã‚‹ç’°å¢ƒ
ä»¥ä¸‹ã®ã‚ˆã†ãªã€ExpressRouteã‚’å…±æœ‰ã™ã‚‹ãƒãƒ«ãƒHub-Spokeç’°å¢ƒã‚’æº–å‚™
![](/images/20230717-SpokeToSpokeER/01.png)

# Effective Routeã®ç¢ºèª
- Hub002ä¸Šã®VMã®Effective Routeã‚’ç¢ºèª
![](/images/20230717-SpokeToSpokeER/02.png)
- Hub002(10.50.0.0/16)ä¸Šã®VMã‹ã‚‰Hub001(10.0.0.0/16)ãŠã‚ˆã³ã€Hub001-Spoke(10.10.0.0/16)ã¸ã®ãƒ«ãƒ¼ãƒˆãŒè¦‹ãˆã¦ã„ã‚‹

# ç–é€šç¢ºèª
- pingã§Hub002ä¸Šã®Windows VM(10.50.0.4)ã‹ã‚‰Hub001-Spokeã®Ubuntu VM(10.10.0.4)ã¸ã®ç–é€šç¢ºèª
![](/images/20230717-SpokeToSpokeER/03.png)

- å¿µã®ãŸã‚ã€Hub002-Spokeä¸Šã®Ubuntu VM(10.60.0.4)ã‹ã‚‰Hub001-Spokeä¸Šã®Ubuntu VM(10.10.0.4)ã¸ã®ç–é€šç¢ºèªã‚‚è¡Œã†
```
AzureAdmin@vm-clab-hub002-spoke:~$ ping 10.10.0.4
PING 10.10.0.4 (10.10.0.4) 56(84) bytes of data.
64 bytes from 10.10.0.4: icmp_seq=1 ttl=63 time=6.70 ms
64 bytes from 10.10.0.4: icmp_seq=2 ttl=63 time=5.33 ms
64 bytes from 10.10.0.4: icmp_seq=3 ttl=63 time=6.70 ms
64 bytes from 10.10.0.4: icmp_seq=4 ttl=63 time=5.80 ms
64 bytes from 10.10.0.4: icmp_seq=5 ttl=63 time=6.32 ms
64 bytes from 10.10.0.4: icmp_seq=6 ttl=63 time=5.29 ms
64 bytes from 10.10.0.4: icmp_seq=7 ttl=63 time=5.60 ms
^C
--- 10.10.0.4 ping statistics ---
7 packets transmitted, 7 received, 0% packet loss, time 6010ms
rtt min/avg/max/mdev = 5.293/5.963/6.701/0.562 ms

```
ã¤ã¾ã‚Šã€ExpressRoute CircuitæŠ˜ã‚Šè¿”ã—ã§`Hub002Spoke-ERGW-MSEE-ERGW-Hub001Spoke`ãŒæˆç«‹ã™ã‚‹ã“ã¨ãŒç¢ºèªã§ããŸã€‚ã¨ã„ã†ã“ã¨ã¯ã€åŒã˜ER Circuitã‚’å…±æœ‰ã—ã¦ã„ã‚‹ã¨çµŒè·¯çš„ã«ã¯ç¹‹ãŒã£ã¦ã„ã‚‹Hub-Spokeç’°å¢ƒãŒè¦‹ãˆã¦ã—ã¾ã†ãŸã‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å®Œå…¨ã«åˆ†é›¢ã™ã‚‹ã«ã¯ER Circuitã”ã¨åˆ†ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ãˆã‚‹ã€‚ã€‚ã€‚

::: message
### ExpressRoute Circuitä¸Šã§è¦‹ãˆã¦ã„ã‚‹ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèªæ–¹æ³•
- ER Circuitä¸Šã§ç¢ºèªã—ãŸã„ãƒ”ã‚¢ãƒªãƒ³ã‚°ã‚’é¸æŠã—ã€ä¸Šéƒ¨ã®[ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹]ã‚’ã‚¯ãƒªãƒƒã‚¯
![](/images/20230717-SpokeToSpokeER/04.png)
- ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹(ã“ã“ã§ã¯MSPeeringã‚‚æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€ã‚ªãƒ³ãƒ—ãƒ¬å´ã‹ã‚‰ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ãŒåºƒå ±ã•ã‚Œã¦ã„ã‚‹ãŸã‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå¸¯ã‚‚å«ã‚ã¦å–å¾—ã•ã‚Œã¦ã„ã‚‹)
![](/images/20230717-SpokeToSpokeER/05.png)
:::

# ãŠã¾ã‘:Global Reach
- ã¤ã„ã§ã«ã€ExpressRouteã®Global ReachçµŒç”±ã§ãƒªãƒ¼ã‚¸ãƒ§ãƒ³é–“ã®VNETé–“é€šä¿¡ãŒã§ãã‚‹ã®ã§ã¯ï¼Ÿã¨æ€ã„ã€æ¤œè¨¼ã—ã¦ã¿ãŸ
- ç’°å¢ƒã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸(ã‚ªãƒ³ãƒ—ãƒ¬å´ã§è¥¿æ—¥æœ¬ã®ExpressRouteç”¨ã®ã‚¹ã‚¤ãƒƒãƒã®æ§‹æˆãŒæ‰‹é–“ã ã£ãŸãŸã‚ã€å˜ã«Azureå´ã ã‘æ§‹æˆã—ã¦ã„ã‚‹)
![](/images/20230717-SpokeToSpokeER/06.png)

## Effective Routeã®ç¢ºèª
- Japan Westå´ã®Hubã«ç½®ã„ãŸVMã®Effective Routeã‚’ç¢ºèª
- Japan Eastå´ã®Hub,Spokeã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¸ã®çµŒè·¯ãŒã™ã¹ã¦æµã‚Œè¾¼ã‚“ã§ãã¦ã„ã‚‹
    - ã¤ã¾ã‚Šã€Global ReachçµŒç”±ã§ãƒªãƒ¼ã‚¸ãƒ§ãƒ³é–“ãƒ”ã‚¢ãƒªãƒ³ã‚°çš„ãªã“ã¨ãŒã§ãã¦ã„ã‚‹ã“ã¨ã«ãªã‚‹
![](/images/20230717-SpokeToSpokeER/07.png)

## å¿µã®ãŸã‚ã€Pingã‚‚ç¢ºèª
- Japan Eastã®Hubã®Windows VMã‹ã‚‰Japan Westã®Hubã®Ubuntu VMã¸Ping
![](/images/20230717-SpokeToSpokeER/08.png)
æƒ³å®šé€šã‚Šã€ç–é€šã§ããŸã€‚

# ãŠã‚ã‚Š
- éæ¨å¥¨ãªãŒã‚‰ã‚‚ERCircuitæŠ˜ã‚Šè¿”ã—ã§ç–é€šãŒã§ãã‚‹ã“ã¨ã¯ç¢ºèªã§ããŸ
- å…·ä½“çš„ã«ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¿…è¦ã¨ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã¯æ€ã„ã¤ã„ã¦ã„ãªã„ãŒã€æ€§è³ªã¨ã—ã¦çŸ¥ã£ã¦ãŠãã®ã¯ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€ã€ï¼


