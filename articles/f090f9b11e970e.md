---
title: "Bicepä½¿ã†ã¨ãã«[KeyVault].getSecret()ã®é¡ã«æ°—ã‚’ä»˜ã‘ã‚ˆã†ãª"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azure","bicep","IaC"]
published: false
publication_name: "microsoft"
---

# ãƒ¢ãƒãƒ™
Azure Key Vaultã‚’å‚ç…§ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå„ä»‹ã ã¨èãã€ã¡ã‚‡ã£ã¨è©¦ã—ã¦ã¿ãŸã¨ã“ã‚æ€ã£ãŸã‚ˆã‚Šå„ä»‹ã ã£ãŸã®ã§è©¦ã—ãŸã“ã¨ã‚’é †ç•ªã«è¨˜éŒ²ã—ã¦ã„ã

# å®Ÿç¾ã—ãŸã„ã“ã¨
1å›ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®ä¸­ã§ã€
1. Key Vaultã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—
2. Key Vaultã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã—ã¦VMã®ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ ¼ç´ã—
3. ãã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å‚ç…§ã™ã‚‹å½¢ã§VMã‚’ä½œæˆã™ã‚‹

## æ³¨æ„äº‹é …
æ‰‹é †3ã§Key Vaultã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å‚ç…§ã™ã‚‹éš›ã€`getSecret()`ã®ã‚ˆã†ãªé–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã®ã ãŒã€ã“ã‚Œã¯moduleã®å¤‰æ•°ã¨ã—ã¦æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã€ä¾‹ãˆã°`vm.bicep`ã®ä¸­ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ããªã„ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚‹(ãªãœ)ã€‚

```bicep
module CreateVM './modules/vm.bicep' = {
  name: 'create-vm-module'
  params: {
    location: resourceGroup().location
    vmName: vmName
    vnetName: vnetName
    subnetName: subnetName
    vmAdminUserName: vmAdminUserName
    vmAdminPassword: keyVault.getSecret('vmAdminPassword')
  }
  dependsOn: [
    CreateVnet
  ]
}
```
# ã‚„ã£ã¦ã¿ã‚‹

## æœ€åˆã®å–ã‚Šçµ„ã¿
æ§‹æˆè‡ªä½“ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªãŸã‚ã€ã¨ã‚Šã‚ãˆãšä»¥ä¸‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§Bicepãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’æ§‹æˆã—ã€Azure CLIã«ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ãŸã€‚`main.bicep`ã§ã¯KeyVaultã®ä½œæˆã‚‚å®Ÿæ–½ã—ã¦ã„ã‚‹ã€‚

```
main.bicep
    âˆŸvnet.bicep
    âˆŸvm.bicep
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¿ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ã¨ã‚‚ã«çµ‚äº†ã€‚

```
{"code": "KeyVaultParameterReferenceNotFound", "message": "The specified KeyVault '/subscriptions/<subID>/resourceGroups/20230823-bicepvmwithkv/providers/Microsoft.KeyVault/vaults/kv-cloud' could not be found. Please see https://aka.ms/arm-keyvault for usage details."}
```