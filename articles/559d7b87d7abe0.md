---
title: "Azure VMã«è¤‡æ•°NICã‚’é–¢é€£ä»˜ã‘ã‚‹éš›ã®åˆæœŸè¨­å®š"
emoji: "ğŸ¤¹â€â™€ï¸"
type: "tech"
topics:
  - "azure"
  - "network"
  - "vm"
  - "nic"
published: true
published_at: "2022-12-13 14:41"
---

# ãƒ¢ãƒãƒ™
- Azureã®VMã«ã¯NICã‚’è¤‡æ•°æ¥ç¶šã§ãã‚‹
- ã§ã‚‚ç¹‹ã’ãŸã ã‘ã ã¨ä½¿ãˆãªã„ã‚‰ã—ã„
- ã‚„ã‚Šæ–¹çŸ¥ã£ã¦ãŠããŸã„

# 2å€‹ç›®ã®NICã®æ¥ç¶š
- ã¾ãšã¯VMã‚’åœæ­¢ã™ã‚‹
- VMã‚’åœæ­¢ã™ã‚‹ã¨æ–°ã—ã„NICã‚’æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
- VMãŒèµ·å‹•ã—ã¦ã„ã‚‹ã¨ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã—ã¦æ¥ç¶šã§ããªã„

![](https://storage.googleapis.com/zenn-user-upload/3cf54ea16e98-20221213.png)
- è¿½åŠ å®Œäº†

![](https://storage.googleapis.com/zenn-user-upload/82e126cd4b06-20221213.png)

:::message
- åŒä¸€ã®VMã«æ¥ç¶šã™ã‚‹NICã¯åŒã˜VNETå†…ã«å­˜åœ¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚µãƒ–ãƒãƒƒãƒˆã¯ç•°ãªã£ã¦ã„ã¦ã‚‚OK
:::

- ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã“ã‚“ãªæ„Ÿã˜ã§ä½œã£ãŸã€‚VMé–“ã®æ¥ç¶šã‚’è©¦ã—ã¦ã¿ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/509541f38158-20221213.png)

# è¤‡æ•°NICã«é–¢ã™ã‚‹ã‚²ã‚¹ãƒˆOSå´ã®è¨­å®š
- ã‚ã¨ã‹ã‚‰è¿½åŠ ã—ãŸNICã«ã¤ã„ã¦ã¯ã€æ—¢å®šã ã¨åŒã˜ã‚µãƒ–ãƒãƒƒãƒˆå†…ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
- ä¸‹è¨˜ã‚µã‚¤ãƒˆã®æ‰‹é †ã«å‰‡ã‚Šã€ã€Œ2æšç›®ã®NIC->Subnetã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã€ã¨ã„ã†çµŒè·¯ã‚’æ˜ç¤ºçš„ã«ä¸ãˆã‚‹å¿…è¦ãŒã‚ã‚‹

https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/multiple-nics#configure-guest-os-for-multiple-nics

## ç¾æ™‚ç‚¹ã§ã®ç–é€šç¢ºèª
- VMâ‘¡ã¸RDPã—ã€VMâ‘ ã®NICâ‘¡ã¸ã®ç–é€šç¢ºèªã‚’è¡Œã†
- Windows Firewallã§ICMPè¨±å¯ãŒé¢å€’ãªã®ã§3389ã§ç¢ºèª

```
$ Test-NetConnection 10.6.1.4 -p 3389
```
- FalseãŒè¿”ã£ã¦ãã‚‹

![](https://storage.googleapis.com/zenn-user-upload/97418892c90b-20221213.png)

## VMâ‘ ã§NICâ‘¡ã‚’æ§‹æˆ
- VMâ‘ ã«RDPã™ã‚‹
- route printã§çµŒè·¯ç¢ºèª
- è¿½åŠ ã—ãŸNICã‹ã‚‰ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¸ã®ãƒ«ãƒ¼ãƒˆãŒãªã„ã“ã¨ãŒåˆ†ã‹ã‚‹
![](https://storage.googleapis.com/zenn-user-upload/8037faaaf2f5-20221213.png)

- ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã«ã¦çµŒè·¯ã‚’è¿½åŠ ã™ã‚‹
	- ã€Œ10.6.1.1ã€ã¯subnet2ã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚¢ãƒ‰ãƒ¬ã‚¹(ã‚µãƒ–ãƒãƒƒãƒˆã®.1ã¯ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤)
	- ã€ŒIF 12ã€ã¯route printã—ãŸã¨ãã«å‡ºã¦ãã‚‹è¿½åŠ NICã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ç•ªå·
	- ã€Œ-pã€ã¯VMå†èµ·å‹•å¾Œã«ã‚‚ãƒ«ãƒ¼ãƒˆãŒæ®‹ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®persistentè¨­å®š
	- ã€ŒMETRICã€ã¯æ˜ç¤ºçš„ã«è¿½åŠ ã—ã¦ã‚‚ã‚ˆã„ãŒã€ãªã‘ã‚Œã°å‹æ‰‹ã«è¿½åŠ ã•ã‚Œã‚‹
```
$ route add -p 0.0.0.0 mask 0.0.0.0 10.6.1.1 IF 12
```

- è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹

![](https://storage.googleapis.com/zenn-user-upload/c95bf0766055-20221213.png)

## ã“ã®çŠ¶æ…‹ã§VMâ‘¡ã‹ã‚‰VMâ‘ ã®NICâ‘¡ã¸ã®ç–é€šç¢ºèª
- åŒã˜ãä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰
```
$ Test-NetConnection 10.6.1.4 -p 3389
```

- Trueã§è¿”ã£ã¦ãã‚‹
![](https://storage.googleapis.com/zenn-user-upload/88c040e0b508-20221213.png)
![](https://storage.googleapis.com/zenn-user-upload/80f6d7d9cfa5-20221213.png)

# ãŠã‚ã‚Š
OSä¸Šã®ãƒ«ãƒ¼ãƒˆã‚’Persistentã§ã„ã˜ã‚‹ã®ãŒã¡ã‚‡ã£ã¨æ€–ã„ã‚ˆã†ãªã€‚