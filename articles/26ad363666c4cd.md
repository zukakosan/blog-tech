---
title: "ÊâãÂÖÉ„ÅÆHyper-V‰∏ä„ÅÆWindows Server 2022(Gen2)„ÇíAzure„Å´ÊåÅ„Å°Ëæº„Çì„ÅßÂà©Áî®„Åô„Çã"
emoji: "üêà"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: []
published: false
---
# „É¢„ÉÅ„Éô
- ÊâãÂÖÉ„ÅÆHyper-V„ÅßÁ®ºÂÉç„Åó„Å¶„ÅÑ„ÇãWindows Server„ÇíAzure„Å´ÊåÅ„Å°Ëæº„Çì„ÅßÂà©Áî®„Åó„Åü„ÅÑ„Ç∑„Éä„É™„Ç™„ÅÆÊ§úË®º„Åå„Åó„Åü„ÅÑ
- Âçò„Å´ÁßªË°å„Å®„ÅÑ„ÅÜ„Åì„Å®„ÇíËÄÉÊÖÆ„Åô„Çã„ÅÆ„Åß„ÅÇ„Çå„Å∞Azure Migrate„ÇíÂà©Áî®„Åô„Çã„ÅÆ„Åå„Ç∑„É≥„Éó„É´„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„Åå„ÄÅ„ÇØ„É©„Ç§„Ç¢„É≥„ÉàOSÈùûÂØæÂøú„ÅÆ„Åü„ÇÅ„ÄåVHD„ÇíÊåÅ„Å°Ëæº„ÇÄ„Äç„Éë„Çø„Éº„É≥„Åß„ÅÆAzureÁßªË°å„ÇíË©¶„Åó„Å¶„Åø„Çã
‚Äª„Å™„Åä„ÄÅSysprep„ÅØ‰∏ÄÊó¶ÁÑ°„Åó„ÅßÂÆüÊñΩ„Åó„Å¶„Åæ„Åô

# Hyper-V‰∏ä„Å´Windows Server 2022„ÅÆVM„Çí‰ΩúÊàê
- „Åì„ÅÆ„ÅÇ„Åü„Çä„Å´.iso„ÅåÁΩÆ„ÅÑ„Å¶„ÅÇ„Çã„ÅÆ„Åß„Åù„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÂèÇÁÖß„Åô„ÇãÂΩ¢„ÅßOS„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„ÇíÂÆüÊñΩ
    - https://info.microsoft.com/ww-landing-windows-server-2022.html

::: details „Ç§„É≥„Çπ„Éà„Éº„É´ÊâãÈ†Ü
- Windows11‰∏ä„ÅßHyper-V„ÇíÊúâÂäπÂåñ
- Hyper-V‰∏ä„Åß[Êñ∞Ë¶è]>[‰ªÆÊÉ≥„Éû„Ç∑„É≥]„Åã„ÇâVM‰ΩúÊàê
    - ![](/images/20230531-vhdfromlocal/01.png)
- ‚Äª‰ªäÂõû„ÅØÁ¨¨2‰∏ñ‰ª£„ÇíÂà©Áî®„Åó„Åü„ÅÑ„ÅÆ„Åß„ÄÅ[Á¨¨2‰∏ñ‰ª£]„ÇíÈÅ∏Êäû„Åô„Çã(**Âæå„ÅÆ„Éè„Éû„Çä„Éù„Ç§„É≥„Éà**)
    - ![](/images/20230531-vhdfromlocal/02.png)
- VMÂÅ¥„Åß„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÂà©Áî®
    - ![](/images/20230531-vhdfromlocal/03.png)
- vhdx„ÅÆ‰øùÂ≠òÂ†¥ÊâÄ
    - ![](/images/20230531-vhdfromlocal/04.png)
- iso„Éï„Ç°„Ç§„É´„ÅÆÊåáÂÆö
    - ![](/images/20230531-vhdfromlocal/05.png)


::: 

- ÂÖ∑‰ΩìÁöÑ„Å™‰ΩúÊàêÊâãÈ†Ü„ÅØ„Åì„Å°„Çâ„ÇÇÂèÇËÄÉ„Å´(„ÇØ„Ç§„ÉÉ„ÇØ‰ΩúÊàê)
    - https://inab818.site/microsoft-hyperv/windows10-windows-server-2022-download-install/


# Hyper-V VM‰∏ä„ÅßÂøÖË¶Å„Å™Â§âÊõ¥„ÇíÂÆüÊñΩ
- „Åì„Åì„Åß„ÅØGoogle ChromeÂÖ•„Çå„Åü„Çä„ÄÅDesktop„Å´„ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„ÇíÈÖçÁΩÆ
    - ![](/images/20230531-vhdfromlocal/06.png)

# VHD„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÅÆÊ∫ñÂÇô
## „Ç≤„Çπ„ÉàOS‰∏ä„Åß„ÅÆ‰ΩúÊ•≠
- „Åì„Å°„Çâ„ÅÆDocs„Å´„ÅÇ„ÇãÊâãÈ†Ü„Çí„Éù„ÉÅ„Éù„ÉÅ„ÇÑ„Å£„Å¶„ÅÑ„Åè
    - https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#complete-the-recommended-configurations
    - „Åì„ÅÆ‰ΩúÊ•≠„ÅÆ‰∏≠„Åß„ÄÅ„Ç≤„Çπ„ÉàOSÂÅ¥„ÅÆRDPË®±ÂèØ„ÅÆË®≠ÂÆö(Marketplace‰∏ä„ÅÆVM„Åß„ÅØÊó¢ÂÆö„ÅßË®±ÂèØ)„Å™„Å©„ÇÇË°å„Å£„Å¶„ÅÑ„Åè
- „Åæ„Åü„ÄÅAzure Portal„Åß„ÅÆÁÆ°ÁêÜ„ÅÆ„Åü„ÇÅ„Å´**‰ªÆÊÉ≥„Éû„Ç∑„É≥„Ç®„Éº„Ç∏„Çß„É≥„Éà**„ÇÇÂÖ•„Çå„Å¶„Åä„Åè‰∫ã„ÅåÊé®Â•®
    - https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/prepare-for-upload-vhd-image#complete-the-recommended-configurations
    - Áõ¥„É™„É≥„ÇØÔºöhttps://go.microsoft.com/fwlink/?LinkID=394789
    - ![](/images/20230531-vhdfromlocal/07.png)
- Windows Update„ÇÇÂΩì„Å¶„Çã
    - ![](/images/20230531-vhdfromlocal/08.png)

## Hyper-V„Ç≥„É≥„ÇΩ„Éº„É´‰∏ä„Åß„ÅÆ‰ΩúÊ•≠
- [„Éá„Ç£„Çπ„ÇØ„ÅÆÁ∑®ÈõÜ]„Åã„ÇâVHD„Çí‰Ωú„Å£„Å¶„ÅÑ„Åè(Azure„Å´ÊåÅ„Å°Ëæº„ÇÅ„Çã„ÅÆ„ÅØÂõ∫ÂÆöÂÆπÈáè„ÅÆVHD„ÅÆ„Åø)
::: details Ë®≠ÂÆöÈ†ÖÁõÆ(„Çπ„ÇØ„Ç∑„Éß‰ªò„Åç)
- ÊßãÊàê„Åó„ÅüHyper-V‰∏ä„ÅÆVM„ÅÆVHDX„ÇíÈÅ∏Êäû
    - ![](/images/20230531-vhdfromlocal/09.png)
- [Â§âÊèõ]„Åã„ÇâVHDX„Çí„ÇÇ„Å®„Å´Êñ∞„Åó„ÅÑVHD„Çí‰ΩúÊàê
    - ![](/images/20230531-vhdfromlocal/10.png)
- [VHD]„ÇíÈÅ∏Êäû
    - ![](/images/20230531-vhdfromlocal/11.png)
- [ÂÆπÈáèÂõ∫ÂÆö]„ÇíÈÅ∏Êäû
    - ![](/images/20230531-vhdfromlocal/12.png)
- Êñ∞Ë¶èVHD„ÅÆÂêçÂâç„Çí‰ªò„Åë„Å¶‰øùÂ≠ò
    - ![](/images/20230531-vhdfromlocal/13.png)
- Á∑®ÈõÜ„ÅÆÂÆå‰∫Ü„ÇíÂæÖ„Å§(Â∞ë„ÄÖÊôÇÈñì„Åå„Åã„Åã„Çã)
    - ![](/images/20230531-vhdfromlocal/14.png)
- VHD„ÅÆÁîüÊàê„ÇíÁ¢∫Ë™ç„Åó„Å¶„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÅÆÊâãÈ†Ü„Å∏Áßª„Çã
    - ![](/images/20230531-vhdfromlocal/15.png)
:::

# VHD„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
- ÊâãÈ†Ü„ÅØ„Åì„ÅÆDocs„Å´Ëºâ„Å£„Å¶„ÅÑ„Çã
    - https://learn.microsoft.com/ja-jp/azure/virtual-machines/windows/disks-upload-vhd-to-managed-disk-powershell#manual-upload
    - ‰ªäÂõû„ÅØ„ÄÅÊâãÂãï„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÅÆ„Éë„Éº„Éà„ÇíÂÆüÊñΩ
        - Connect-AzAccount
        - „É≠„Éº„Ç´„É´„ÅÆPowerShell„Åã„ÇâAzure„Å´Á©∫„ÅÆ„Éû„Éç„Éº„Ç∏„Éâ„Éá„Ç£„Çπ„ÇØ„Çí‰ΩúÊàê
        - „Éû„Éç„Éº„Ç∏„Éâ„Éá„Ç£„Çπ„ÇØ„ÅÆSAS„ÇíÁô∫Ë°å
        - SASÁµåÁî±„ÅßVHD„Çí„Éû„Éç„Éº„Ç∏„Éâ„Éá„Ç£„Çπ„ÇØ„Å´ÊµÅ„ÅóËæº„Åø
        - SAS„ÇíÂ§±Âäπ
        - VM‰ΩúÊàê
- Docs„ÅÆÊâãÈ†Ü„Çí„Åì„Å™„Åó„Å¶„ÅÑ„Åè
::: message alert
- Docs„ÅÆÊâãÈ†Ü„Å´„Åä„ÅÑ„Å¶„ÄÅ„Éá„Ç£„Çπ„ÇØÊßãÊàê„Çí‰ΩúÊàê„Åô„Çã„Ç≥„Éû„É≥„Éâ„Å´Ë¶ÅÊ≥®ÊÑè

```powershell:NG‰æã
PS> $diskconfig = New-AzDiskConfig -SkuName 'Standard_LRS' -OsType 'Windows' -UploadSizeInBytes $vhdSizeBytes -Location '<yourregion>' -CreateOption 'Upload'
```
- „Åì„ÅÆ„Åæ„ÅæÂÆüË°å„Åô„Çã„Å®„Éá„Ç£„Çπ„ÇØ„ÅÆË®≠ÂÆö„Å®„Åó„Å¶Hyper-V„ÅÆ‰∏ñ‰ª£„ÅåÊó¢ÂÆöÂÄ§„Åß„ÅÇ„Çã`V1`=`Gen1`„Å®„Åó„Å¶Ë™çË≠ò„Åï„Çå„Å¶„Åó„Åæ„ÅÜ
- „Åù„ÅÆ„Éá„Ç£„Çπ„ÇØ„ÅßVM„Çí‰ΩúÊàê„Åô„Çã„Å®„ÄÅ„Éá„Ç£„Çπ„ÇØ„Å®„Åó„Å¶„ÅØ`Gen1`„Å™„ÅÆ„Å´VHD„Å®„Åó„Å¶„ÅØ`Gen2`„Å®„Å™„Çä„ÄÅAzure VM„Åå`Boot Failure`„ÇíËµ∑„Åì„Åô
- „Çà„Å£„Å¶‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´ÊòéÁ§∫ÁöÑ„Å´‰∏ñ‰ª£„ÇíÊåáÂÆö„Åô„Çã

```powershell:OK‰æã
ps> $diskconfig = New-AzDiskConfig -SkuName 'Standard_LRS' -OsType 'Windows' -UploadSizeInBytes $vhdSizeBytes -Location 'eastus' -CreateOption 'Upload' -HyperVGeneration 'V2'
```
:::

- AzCopy„Å´„Å§„ÅÑ„Å¶„ÅÆË£úË∂≥
    - AzCopyËá™‰Ωì„ÅØ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Å™„ÅÆ„Åß„Ç§„É≥„Çπ„Éà„Éº„É´„Åô„Çã„ÇÇ„ÅÆ„Åß„ÅØ„Å™„ÅÑ
    - ‰∏ãË®ò„É™„É≥„ÇØ„Åã„Çâ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶Ëß£Âáç„Åó„Å¶„Åä„Åè
        - https://learn.microsoft.com/ja-jp/azure/storage/common/storage-use-azcopy-v10#download-azcopy
    - „Ç≥„Éû„É≥„ÉâËá™‰Ωì„ÅØ„Åì„Çì„Å™ÊÑü„Åò„Å´„Å™„Çã„ÅØ„Åö
    ```powershell
    ps> .\azcopy.exe copy "C:\ProgramData\Microsoft\Windows\Virtual Hard Disks\vhd-export.vhd" $diskSas.AccessSAS --blob-type PageBlob
    ```
    - „Åì„Çì„Å™ÊÑü„Åò„ÅßÁµÇ„Çè„Çã
    ```
    100.0 %, 1 Done, 0 Failed, 0 Pending, 0 Skipped, 1 Total,
    
    Job b052fe70-fe57-8445-75fa-0bd8795e9386 summary
    Elapsed Time (Minutes): 5.3346
    Number of File Transfers: 1
    Number of Folder Property Transfers: 0
    Number of Symlink Transfers: 0
    Total Number of Transfers: 1
    Number of File Transfers Completed: 1
    Number of Folder Transfers Completed: 0
    Number of File Transfers Failed: 0
    Number of Folder Transfers Failed: 0
    Number of File Transfers Skipped: 0
    Number of Folder Transfers Skipped: 0
    TotalBytesTransferred: 136365212160
    Final Job Status: Completed
    ```
